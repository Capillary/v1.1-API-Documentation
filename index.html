<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>API Reference</title>

    <style>
      .highlight table td { padding: 5px; }
.highlight table pre { margin: 0; }
.highlight, .highlight .w {
  color: #f8f8f2;
  background-color: #272822;
}
.highlight .err {
  color: #272822;
  background-color: #f92672;
}
.highlight .c, .highlight .cd, .highlight .cm, .highlight .c1, .highlight .cs {
  color: #75715e;
}
.highlight .cp {
  color: #f4bf75;
}
.highlight .nt {
  color: #f4bf75;
}
.highlight .o, .highlight .ow {
  color: #f8f8f2;
}
.highlight .p, .highlight .pi {
  color: #f8f8f2;
}
.highlight .gi {
  color: #a6e22e;
}
.highlight .gd {
  color: #f92672;
}
.highlight .gh {
  color: #66d9ef;
  background-color: #272822;
  font-weight: bold;
}
.highlight .k, .highlight .kn, .highlight .kp, .highlight .kr, .highlight .kv {
  color: #ae81ff;
}
.highlight .kc {
  color: #fd971f;
}
.highlight .kt {
  color: #fd971f;
}
.highlight .kd {
  color: #fd971f;
}
.highlight .s, .highlight .sb, .highlight .sc, .highlight .sd, .highlight .s2, .highlight .sh, .highlight .sx, .highlight .s1 {
  color: #a6e22e;
}
.highlight .sr {
  color: #a1efe4;
}
.highlight .si {
  color: #cc6633;
}
.highlight .se {
  color: #cc6633;
}
.highlight .nn {
  color: #f4bf75;
}
.highlight .nc {
  color: #f4bf75;
}
.highlight .no {
  color: #f4bf75;
}
.highlight .na {
  color: #66d9ef;
}
.highlight .m, .highlight .mf, .highlight .mh, .highlight .mi, .highlight .il, .highlight .mo, .highlight .mb, .highlight .mx {
  color: #a6e22e;
}
.highlight .ss {
  color: #a6e22e;
}
    </style>
    <link href="stylesheets/screen.css" rel="stylesheet" media="screen" />
    <link href="stylesheets/print.css" rel="stylesheet" media="print" />
      <script src="javascripts/all.js"></script>
  </head>

  <body class="index" data-languages="[&quot;json&quot;]">
    <a href="#" id="nav-button">
      <span>
        NAV
        <img src="images/navbar.png" alt="Navbar" />
      </span>
    </a>
    <div class="tocify-wrapper">
      <img src="images/logo.png" alt="Logo" />
        <div class="lang-selector">
              <a href="#" data-language-name="json">json</a>
        </div>
        <div class="search">
          <input type="text" class="search" id="input-search" placeholder="Search">
        </div>
        <ul class="search-results"></ul>
      <div id="toc">
      </div>
        <ul class="toc-footer">
            <li><a href='#'>Capillary V1.0 API Documentation</a></li>
            <li><a href='https://github.com/tripit/slate'>Documentation Powered by Slate</a></li>
        </ul>
    </div>
    <div class="page-wrapper">
      <div class="dark-box"></div>
      <div class="content">
        <h1 id="getting-started">Getting Started</h1>

<p>The Capillary APIs are RESTful APIs that help third party applications manage an Organization’s CRM and/or Loyalty Program through Capillary’s platform. This document lists the APIs that can be used to integrate with the Capillary Server Application, their descriptions, resource information, request parameters, request URIs, and sample requests.</p>

<h2 id="organization-setup">Organization Setup</h2>

<p>Every organization associated with Capillary is registered in InTouch. Based on the organization&rsquo;s architecture, store TILL /Store Center accounts are created for the organization apart from zones, concepts and stores. Only Capillary users have access to register an organization inTouch. Contact your Capillary Account Manager or Delivery Manager.</p>

<p>To set up an organization as a Capillary admin, see Setting up Organization. </p>

<h2 id="authentication">Authentication</h2>

<p>Capillary APIs are accessed using the TILL/Store Center credentials that are created when registering the organization. Please note that it is mandatory to use only the store specific Till/Store center credentials of the organization as the data in the API response depends on this identification.</p>

<aside class="notice">
Use Case: 
For instance, assume that a retailer XYZ of India cluster is registered with Capillary with 2 stores - store1 and store2. Each store has 2 TILLS - till1 and till2(for store1), till3 and till4(for store2). 

If you authenticate using till1 credentials, you can access org level data and only the data of Store1. You cannot access the data of Store2.
</aside>

<aside class="warning">
For any assistance on Organization setup, please contact your Capillary&rsquo;s Account Manager.
</aside>

<h2 id="authentication">Authentication</h2>

<p>To obtain access to the entities of the Capillary Rest APIs, you need to authenticate the TILL/store center account that you are referring to for using the HTTP Basic Authentication.</p>

<p>Authorization Header is used for validating authentication credentials. The Authorization Header is constructed as shown below:</p>

<p><code class="prettyprint">Authorization: Basic &lt;Base64 encoded (username: md5(password))&gt;</code></p>

<p>In the Authorization Header pass the encoded Base64 form of username and md5 formatted password.</p>

<aside class="notice">
For example, to authenticate using TILL1 credentials whose password is 123: 

First convert the password ‘123’ in md5 form. i,e., 202cb962ac59075b964b07152d234b70

Then encode the username and md5 password to Base64. i.e. 

`Base64(till1: 202cb962ac59075b964b07152d234b70)` which is `Authorization: Basic dGlsbDE6IDIwMmNiOTYyYWM1OTA3NWI5NjRiMDcxNTJkMjM0Yjcw`
</aside>

<h2 id="tracking-request">Tracking Request</h2>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"Date"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Wed, 16 Dec 2015 06:05:13 GMT"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"Content-Type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"application/json; charset=utf-8"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"Cache-Control"</span><span class="p">:</span><span class="w"> </span><span class="s2">"must-revalidate,no-cache,no-store"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"X-Cap-Requestid"</span><span class="p">:</span><span class="w"> </span><span class="s2">"5670FF17B7D58"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"Server"</span><span class="p">:</span><span class="w"> </span><span class="s2">"CapWS"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"Content-Encoding"</span><span class="p">:</span><span class="w"> </span><span class="s2">"gzip"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"X-Cache"</span><span class="p">:</span><span class="w"> </span><span class="s2">"MISS from localhost"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"Transfer-Encoding"</span><span class="p">:</span><span class="w"> </span><span class="s2">"chunked"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"Connection"</span><span class="p">:</span><span class="w"> </span><span class="s2">"keep-alive"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<p>A unique id is generated for every request made using Capillary APIs and is sent to the requestor in the Response Headers as &ldquo;X-Cap-Requestid&rdquo;. 
You can use this request id to track the request end-to-end.
&lt;aside class=&ldquo;notice&rdquo;
It is recommended to note the <code class="prettyprint">X-Cap-Requestid</code> of a request for future requirements.</p>

<aside class="notice">
When an API call is made with 4 batch transactions, A response header is generated with the `X-Cap-Requestid` as shown above. This id can be used to track the details of the entire API call (both request and response).
</aside>

<h2 id="http-request">HTTP Request</h2>

<table><thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>Request URL Format</td>
<td>http://<host>/<API version no.>/<entity>/<method>.<format></td>
</tr>
<tr>
<td>Host</td>
<td>The server to which the API calls are made (cluster URL). <strong>India</strong>: intouch.capillary.co.in, <strong>APAC2</strong>: apac2.intouch.capillarytech.com, <strong>EU</strong>: eu.intouch.capillarytech.com, <strong>US</strong>: us.intouch.capillarytech.com</td>
</tr>
<tr>
<td>API Version Number</td>
<td>v1.1</td>
</tr>
<tr>
<td>Entity</td>
<td>Provide the appropriate entity based on the action to be performed. The supported entities are communications, coupon, customer, organization, points, product, store, and transaction</td>
</tr>
<tr>
<td>HTTP Methods</td>
<td>The Capillary Cloud REST APIs support the standard HTTP methods - GETand POST</td>
</tr>
<tr>
<td>Response Format</td>
<td>The format for requesting data from the APIs (xml, json). V1.1 APIs return information in the XML format by default. To get json response, mention <code class="prettyprint">format=xml</code> explicitly.</td>
</tr>
</tbody></table>

<h2 id="response-codes">Response Codes</h2>
<pre class="highlight xml"><code># API level Response Code

<span class="nt">&lt;status&gt;</span>
<span class="nt">&lt;success&gt;</span>true<span class="nt">&lt;/success&gt;</span>
<span class="nt">&lt;code&gt;</span>200<span class="nt">&lt;/code&gt;</span>
<span class="nt">&lt;message&gt;</span>Operation Successful<span class="nt">&lt;/message&gt;</span>
<span class="nt">&lt;/status&gt;</span>
</code></pre><pre class="highlight xml"><code># Item Level Response Code

<span class="nt">&lt;item_status&gt;</span>
<span class="nt">&lt;success&gt;</span>false<span class="nt">&lt;/success&gt;</span>
<span class="nt">&lt;code&gt;</span>1001<span class="nt">&lt;/code&gt;</span>
<span class="nt">&lt;message&gt;</span>Invalid Mobile Number<span class="nt">&lt;/message&gt;</span>
<span class="nt">&lt;/item_status&gt;</span>

</code></pre>
<p>API responces are generated at request level and item level.</p>

<ul>
<li><strong>Request Level Responses</strong>: These response codes are generated at the request level (for an entire request).</li>
<li><strong>Item Level Responses</strong>: These response codes are generated at individual items of a request.</li>
</ul>

<aside class="notice"> For instance, assume that a batch API call is made to add multiple transactions. The entire request will have a status (successful, failed or partial success)and alse each transaction item will have its own response code element. You can see API level response in the `<status>` element and item level in the `<item_status>` element.
</aside>

<h3 id="api-level-response-codes">API Level Response Codes</h3>

<table><thead>
<tr>
<th>Code</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>200</td>
<td>Success</td>
</tr>
<tr>
<td>201</td>
<td>Some requests have failed due to errors</td>
</tr>
<tr>
<td>500</td>
<td>All requests have failed due to errors</td>
</tr>
<tr>
<td>400</td>
<td>Input is invalid, Please check request parameters or input xml/json</td>
</tr>
<tr>
<td>401</td>
<td>Please check your username/password or authentication token</td>
</tr>
<tr>
<td>402</td>
<td>Version is not supported for this resource</td>
</tr>
<tr>
<td>404</td>
<td>Incorrect resource</td>
</tr>
<tr>
<td>405</td>
<td>Incorrect HTTP Method</td>
</tr>
<tr>
<td>406</td>
<td>Operation is not supported for the resource</td>
</tr>
<tr>
<td>407</td>
<td>Unknown Error happened while processing the request</td>
</tr>
<tr>
<td>408</td>
<td>Network MAC ID does not match</td>
</tr>
</tbody></table>

<h3 id="item-level-response-codes">Item Level Response Codes</h3>

<p>Each entity has a different set of response codes. Item level response codes for each entity is provided in the respective entity section. </p>

          <h1 id="customer">customer</h1>

<p>A customer is an individual who buys goods or services, or subscribes for organization’s newsletters. An organization can be a store, business firm, hospitals or restaurants).</p>

<p>In Capillary’s platform the customer entity represents loyalty customers of the respective organization or just the customers who have subscribed to the organization’s newsletters. </p>

<p>Capillary supports three types of customers based on the loyalty type:</p>

<ul>
<li><strong>Loyalty customers</strong>: Customers who have enrolled into the organization’s loyalty program </li>
<li><strong>Non-loyalty customers</strong>: Customers who have subscribed their mobile number or email id with the organization (through subscriptions, guest transactions etc) but not enrolled into the organization’s loyalty program </li>
<li><strong>Not-interested or anonymous customers</strong>: Customers who have neither enrolled in the loyalty program nor subscribed their mobile numbers/email ids </li>
</ul>

<p>The customer entity stores customer related information such as identifiers, profile details, custom field details, transactions, preferences, subscription details (mobile number/email id), tier details, points history and coupons history.</p>

<p>The customer APIs allow you to</p>

<ul>
<li>Register customers into your organization’s loyalty program </li>
<li>Update customer’s profile information </li>
<li>Update primary or secondary identifiers (mobile no, email id, or external id)</li>
<li>Retrieve customer details (loyalty/non-loyalty)</li>
<li>Submit tickets on behalf of customers and fetch their tickets<br></li>
<li>Add, update and retrieve customer preferences </li>
<li>Retrieve transactions of a customer. </li>
</ul>

<h2 id="register-customer">Register Customer</h2>

<p>To register a customer at your organization, send a POST request to the customer/add endpoint and pass the information of the customer in an XML using the post method. You can register multiple customers at a time by passing the details of each customer in a separate <customer> </customer> tag of the XML sheet.</p>

<p>When registering a customer, the system will check if the mobile no/email id/external id you have provided is already registered at your organization. If any of these parameters are already available in the database then the existing customer details are updated with the recently provided details. Else, the customer is registered with the provided details.</p>

<p>However, to update secondary parameters, allow mobile number change/email id change/external id change should be enabled in your organization’s <strong>InTouch</strong> &gt; <strong>Settings</strong> &gt; <strong>Miscellaneous</strong> &gt; <strong>Registration Configuration</strong> page.</p>

<h2 id="update-customer-details">Update Customer Details</h2>
<pre class="highlight json"><code><span class="err">#</span><span class="w"> </span><span class="err">Sample</span><span class="w"> </span><span class="err">Request</span><span class="w"> </span><span class="err">URL</span><span class="w">
</span><span class="err">http://api.capillary.co.in/v</span><span class="mf">1.1</span><span class="err">/customer/update?format=json</span><span class="w">
</span></code></pre><pre class="highlight json"><code><span class="err">#</span><span class="w"> </span><span class="err">Sample</span><span class="w"> </span><span class="err">Post</span><span class="w"> </span><span class="err">JSON</span><span class="w">
</span><span class="p">{</span><span class="w">
  </span><span class="nt">"root"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"customer"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"mobile"</span><span class="p">:</span><span class="w"> </span><span class="s2">"44700900000"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"email"</span><span class="p">:</span><span class="w"> </span><span class="s2">"tom.sawyer@email.com"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"external_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ts1234"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"firstname"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Tom"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"lastname"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Sawyer"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"gender"</span><span class="p">:</span><span class="w"> </span><span class="s2">"M"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"custom_fields"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"field"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
          </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"age"</span><span class="p">,</span><span class="w">
          </span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"[“46”]"</span><span class="w">
        </span><span class="p">}</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<p>This API allows you to update customer’s profile information of a based on the customer identifier (mobile no/email id/external id) passed.
You can update secondary identifiers (mobile no./email id./external id) only when the respective options are enabled on InStore, i.e., Capillary InTouch &gt; <strong>Settings</strong> &gt; <strong>Miscellaneous</strong> &gt; <strong>Registration Configuration</strong></p>

<ul>
<li>CONF_ALLOW_MOBILE_UPDATE (for mobile number)</li>
<li>CONF_ALLOW_EMAIL_UPDATE (for email id)</li>
<li>CONF_LOYALTY_ALLOW_EXTERNAL_ID_UPDATE (for external id) </li>
</ul>

<p>However, you cannot update the primary identifier of customers using this API even if the option to update the respective identifier is enabled on the <strong>Registration Configuration</strong> page. </p>

<h3 id="resource-information">Resource Information</h3>

<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>URI</td>
<td>customer/update</td>
</tr>
<tr>
<td>Rate Limited?</td>
<td>Yes</td>
</tr>
<tr>
<td>Authentication</td>
<td>Yes</td>
</tr>
<tr>
<td>Response Formats</td>
<td>XML, JSON</td>
</tr>
<tr>
<td>HTTP Method</td>
<td>POST</td>
</tr>
<tr>
<td>Batch Support</td>
<td>No</td>
</tr>
</tbody></table>

<h3 id="request-parameters">Request Parameters</h3>

<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>Mobile/email/external_id*</td>
<td>Pass any one mentioned identifier of the customer whose details need to be updated</td>
</tr>
<tr>
<td>user_id(Boolean)</td>
<td>Returns the unique user ID of the customer if user_id=true</td>
</tr>
</tbody></table>

<h2 id="update-customer-identifiers">Update Customer Identifiers</h2>

<h2 id="fetch-customers-by-partial-strings">Fetch Customers by Partial Strings</h2>

<h2 id="fetch-customer-id">Fetch Customer ID</h2>

<h2 id="fetch-customer-details">Fetch Customer Details</h2>

<p>This API retrieves information of the customer such as profile information, ten recent transactions, active coupons, and recent store interactions. </p>

<p>You can also use filters to see and analyze the data that is required and hide data that you don’t want to see. For more details on supported filters, see the below <strong><em>Request Parameters</em></strong> table.
Parameter | Description
&mdash;&mdash;&mdash; | &mdash;&mdash;&mdash;&ndash;
Resource Information | URI  customer/get
Rate Limited? | Yes
Authentication | Yes
Response Formats | XML, JSON 
HTTP Method | GET
Batch Support | Yes</p>

          <h1 id="transaction">transaction</h1>

<p>In Capillary’s platform a transaction represents a purchase or return event. Transactions are categorized into three types based on customer type as explained in the following:</p>

<ul>
<li><p>Loyalty Transactions: Transactions made by registered customers of your organization&rsquo;s loyalty program</p></li>
<li><p>Non-loyalty Transactions: Transactions made by customers who are not registered into your loyalty program, but shared their mobile number or email id with your organization </p></li>
<li><p>Not-interested Transactions: Transactions made by customers who are not interested to register into your organization’s loyalty program. These transactions are also considered as anonymous transactions. </p></li>
<li><p>The transaction entity stores regular/return transactions, points/coupons redeemed against transactions, retro transactions (converting not interested transactions to loyalty transactions), and custom fields of transaction screen. </p></li>
</ul>

<aside class="notice">
Note: Custom fields are additional fields created in InStore to capture a specific information from customers. For example, favorite color, birthday, favorite brand etc.
</aside>

<p>You can perform the following tasks using transaction APIs</p>

<ul>
<li>Register new customers automatically when submitting transactions </li>
<li>Submit loyalty and non-loyalty transactions </li>
<li>Retrieve list of transactions of a particular store, till, duration or transactions of a specific customer </li>
<li>Assign not interested transactions to specific customers (once they register) - Retro transaction </li>
<li>Redeem points/coupons of customers against their transactions </li>
<li>Retrieve points/coupons redeemed for a particular transaction</li>
</ul>

          <h1 id="points">points</h1>

<p>Points represent loyalty points of an organization that are issued to the loyalty customers based on the transactions made and tiers achieved. Customers can redeem the loyalty points earned by them against transactions. Points are issued only through the Loyalty Manager upon a transaction or tier upgrade but not through API calls.</p>

<p>The points entity allows you to perform the following tasks:</p>

<ul>
<li>Check whether a specific number of points can be redeemed by a customer<br></li>
<li>Validate customer’s mobile number by issuing validation code to redeem points </li>
<li>Redeem loyalty points of a customer after validating the preceding tasks</li>
</ul>

          <h1 id="coupon">coupon</h1>

<p>Coupon represents store promotions or discounts codes created through Capillary Campaign Manager. A single campaign can contain one or more coupons or coupon series. Coupons are issued to loyalty or non-loyalty customers through SMS or email.</p>

<p>You cannot create new coupons using coupon APIs; instead, you can send or retrieve coupons that are already created in your campaigns. Hence, it is important to note the coupon code, coupon id or coupon series id for making API calls.</p>

<p>You cannot create new coupons using coupon APIs; instead, you can send or retrieve coupons that are already created in your campaigns. Hence, it is important to note the coupon code, coupon id or coupon series id for making API calls.</p>

<p>The coupon entity allows you to perform the following tasks:</p>

<ul>
<li>Issue coupons to customers </li>
<li>Resend a specific coupon to the respective customer </li>
<li>Retrieve details of a specific coupon/coupon series </li>
<li>Check whether a customer can redeem a specific coupon and redeem the coupon</li>
</ul>

          <h1 id="communications">communications</h1>

<p>Communications represent personalized messages (SMSs/emails) sent to the loyalty customers. Messages such as transaction notifications, birthday wishes, anniversary wishes can be sent through communications APIs.</p>

<p>The communications entity stores personalized messages, and message templates, To send messages the communication gate way should be enabled for your organization with enough message credits.</p>

<p>The communications entity allows you to perform the following tasks:</p>

<ul>
<li>Fetch details of a specific email/SMS by message id </li>
<li>Send personalized emails/SMSs </li>
<li>Retrieve details of a specific email/sms template </li>
<li>Create new SMS/email templates or update existing templates </li>
</ul>

<h2 id="response-codes">Response Codes</h2>

<h3 id="success-codes">Success Codes</h3>

<h3 id="error-codes">Error Codes</h3>

<table><thead>
<tr>
<th>CODE</th>
<th>DESCRIPTION</th>
</tr>
</thead><tbody>
<tr>
<td>4101</td>
<td>Unable to send message</td>
</tr>
<tr>
<td>4201</td>
<td>Unable to send email</td>
</tr>
<tr>
<td>4102</td>
<td>Unable to find/retrieve SMS</td>
</tr>
<tr>
<td>4202</td>
<td>Unable to find/retrieve email</td>
</tr>
<tr>
<td>4203</td>
<td>Invalid template type passed</td>
</tr>
<tr>
<td>4204</td>
<td>Template not found</td>
</tr>
<tr>
<td>4205</td>
<td>Unable to update the template</td>
</tr>
<tr>
<td>4206</td>
<td>Invalid template id passed</td>
</tr>
<tr>
<td>4207</td>
<td>No template is available with the given parameters</td>
</tr>
<tr>
<td>4208</td>
<td>Invalid email id</td>
</tr>
</tbody></table>

      </div>
      <div class="dark-box">
          <div class="lang-selector">
                <a href="#" data-language-name="json">json</a>
          </div>
      </div>
    </div>
  </body>
</html>
