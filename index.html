<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>API Documentation</title>

    <style>
      .highlight table td { padding: 5px; }
.highlight table pre { margin: 0; }
.highlight, .highlight .w {
  color: #f8f8f2;
  background-color: #272822;
}
.highlight .err {
  color: #272822;
  background-color: #f92672;
}
.highlight .c, .highlight .cd, .highlight .cm, .highlight .c1, .highlight .cs {
  color: #75715e;
}
.highlight .cp {
  color: #f4bf75;
}
.highlight .nt {
  color: #f4bf75;
}
.highlight .o, .highlight .ow {
  color: #f8f8f2;
}
.highlight .p, .highlight .pi {
  color: #f8f8f2;
}
.highlight .gi {
  color: #a6e22e;
}
.highlight .gd {
  color: #f92672;
}
.highlight .gh {
  color: #66d9ef;
  background-color: #272822;
  font-weight: bold;
}
.highlight .k, .highlight .kn, .highlight .kp, .highlight .kr, .highlight .kv {
  color: #ae81ff;
}
.highlight .kc {
  color: #fd971f;
}
.highlight .kt {
  color: #fd971f;
}
.highlight .kd {
  color: #fd971f;
}
.highlight .s, .highlight .sb, .highlight .sc, .highlight .sd, .highlight .s2, .highlight .sh, .highlight .sx, .highlight .s1 {
  color: #a6e22e;
}
.highlight .sr {
  color: #a1efe4;
}
.highlight .si {
  color: #cc6633;
}
.highlight .se {
  color: #cc6633;
}
.highlight .nn {
  color: #f4bf75;
}
.highlight .nc {
  color: #f4bf75;
}
.highlight .no {
  color: #f4bf75;
}
.highlight .na {
  color: #66d9ef;
}
.highlight .m, .highlight .mf, .highlight .mh, .highlight .mi, .highlight .il, .highlight .mo, .highlight .mb, .highlight .mx {
  color: #a6e22e;
}
.highlight .ss {
  color: #a6e22e;
}
    </style>
    <link href="stylesheets/screen.css" rel="stylesheet" media="screen" />
    <link href="stylesheets/print.css" rel="stylesheet" media="print" />
      <script src="javascripts/all_nosearch.js"></script>
  </head>

  <body class="index" data-languages="[]">
    <a href="#" id="nav-button">
      <span>
        NAV
        <img src="images/navbar.png" alt="Navbar" />
      </span>
    </a>
    <div class="tocify-wrapper">
      <img src="images/logo.png" alt="Logo" />
      <div id="toc">
      </div>
    </div>
    <div class="page-wrapper">
      <div class="dark-box"></div>
      <div class="content">
        <h1 id="getting-started">Getting Started</h1>

<p>The Capillary APIs are RESTful APIs that help third party applications manage an Organization’s CRM and Loyalty Program through the Capillary platform. This document provides all the APIs that can be used to integrate with the Capillary Applications, their descriptions, resource information, request parameters, request URIs, and sample requests.</p>

<h2 id="organization-setup">Organization Setup</h2>

<p>An organization associated with Capillary is registered in InTouch. Based on the organization&rsquo;s architecture, store TILL /Store Center accounts are created besides zones, concepts, and stores. Only Capillary users have access to register an organization in inTouch. For more information, contact your  Account Manager or Delivery Manager of Capillary.</p>

<p>To set up an organization as a Capillary admin, see Setting up Organization. </p>

<h2 id="authentication">Authentication</h2>

<p>Capillary APIs are accessed using the TILL/Store Center credentials created when the organization is registered. Please note that it is mandatory to use only the store specific Till/Store center credentials of the organization as the data in the API response depends on this identification.</p>

<aside class="notice">
Use Case: 
For instance, assume that a retailer XYZ of India cluster is registered with Capillary with two stores - store1 and store2. Each store has 2 TILLS - till1 and till2(for store1), till3 and till4(for store2). 

If you authenticate using till1 credentials, you can access org level data and only the data of Store1. You cannot access the data of Store2.
</aside>

<aside class="warning">
For any assistance on Organization setup, please contact your Account Manager of Capillary.
</aside>

<h2 id="authentication">Authentication</h2>

<p>To obtain access to the entities of the Capillary Rest APIs, you need to authenticate the TILL/store center account that you are referring to for using the HTTP Basic Authentication.</p>

<p>Authorization Header is used for validating authentication credentials. The Authorization Header is constructed as shown below:</p>

<p><code class="prettyprint">Authorization: Basic &lt;Base64 encoded (username: md5(password))&gt;</code></p>

<p>In the Authorization Header pass the encoded Base64 form of username and md5 formatted password.</p>

<aside class="notice">
For example, to authenticate using TILL1 credentials whose password is 123: <br>

First convert the password ‘123’ in md5 form. i,e., 202cb962ac59075b964b07152d234b70 <br>

Then encode the username and md5 password to Base64. i.e. <br>

`Base64(till1:202cb962ac59075b964b07152d234b70)` which is `Authorization: Basic dGlsbDE6IDIwMmNiOTYyYWM1OTA3NWI5NjRiMDcxNTJkMjM0Yjcw`
</aside>

<h2 id="tracking-request">Tracking Request</h2>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"Date"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Wed, 16 Dec 2015 06:05:13 GMT"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"Content-Type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"application/json; charset=utf-8"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"Cache-Control"</span><span class="p">:</span><span class="w"> </span><span class="s2">"must-revalidate,no-cache,no-store"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"X-Cap-Requestid"</span><span class="p">:</span><span class="w"> </span><span class="s2">"5670FF17B7D58"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"Server"</span><span class="p">:</span><span class="w"> </span><span class="s2">"CapWS"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"Content-Encoding"</span><span class="p">:</span><span class="w"> </span><span class="s2">"gzip"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"X-Cache"</span><span class="p">:</span><span class="w"> </span><span class="s2">"MISS from localhost"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"Transfer-Encoding"</span><span class="p">:</span><span class="w"> </span><span class="s2">"chunked"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"Connection"</span><span class="p">:</span><span class="w"> </span><span class="s2">"keep-alive"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<p>A unique id is generated for every request made using Capillary APIs and is sent to the requester in the Response Headers as &ldquo;X-Cap-Requestid&rdquo;. 
You can use this request id to track the request end-to-end.
&lt;aside class=&ldquo;notice&rdquo;
It is recommended to note the <code class="prettyprint">X-Cap-Requestid</code> of a request for future requirements.</p>

<aside class="notice">
When an API call is made with 4 batch transactions, A response header is generated with the `X-Cap-Requestid` as shown above. This id can be used to track the details of the entire API call (both request and response).
</aside>

<h2 id="http-request">HTTP Request</h2>

<table><thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>Request URL Format</td>
<td><code class="prettyprint">http://&lt;host&gt;/&lt;API version no.&gt;/&lt;entity&gt;/&lt;method&gt;.&lt;format&gt;</code></td>
</tr>
<tr>
<td>Host</td>
<td>The server to which the API calls are made (cluster URL). <br><strong>India</strong>: apac.api.capillary.co.in <br><strong>APAC2</strong>: apac2.api.capillarytech.com <br><strong>EU</strong>: eu.api.capillarytech.com <br><strong>US</strong>: us.api.capillarytech.com <br><strong>China</strong>: cdn-api.capillarytech.cn.com [or] api.capillarytech.cn.com</td>
</tr>
<tr>
<td>API Version Number</td>
<td>v1.1</td>
</tr>
<tr>
<td>Entity</td>
<td>Resource for which actions are performed. Example: communications, coupon, customer, organization, points, product, store, and transaction</td>
</tr>
<tr>
<td>HTTP Methods</td>
<td>The Capillary Cloud REST APIs support the standard HTTP methods - GET and POST</td>
</tr>
<tr>
<td>Response Format</td>
<td>The format for requesting data from the APIs (xml, json). By default, these APIs return information in XML. To get json response, you need to explicitly specify <code class="prettyprint">format=json</code> or just pass the request url with <code class="prettyprint">.json</code> extension. <br>Example: <code class="prettyprint">http://eu.api.capillarytech.com/v1.1/customer/add.json</code></td>
</tr>
</tbody></table>

<h2 id="response-codes">Response Codes</h2>
<pre class="highlight xml"><code># API level Response Code

<span class="nt">&lt;status&gt;</span>
<span class="nt">&lt;success&gt;</span>true<span class="nt">&lt;/success&gt;</span>
<span class="nt">&lt;code&gt;</span>200<span class="nt">&lt;/code&gt;</span>
<span class="nt">&lt;message&gt;</span>Operation Successful<span class="nt">&lt;/message&gt;</span>
<span class="nt">&lt;/status&gt;</span>
</code></pre><pre class="highlight json"><code><span class="err">#</span><span class="w"> </span><span class="err">API</span><span class="w"> </span><span class="err">level</span><span class="w"> </span><span class="err">Response</span><span class="w"> </span><span class="err">Code</span><span class="w">

</span><span class="p">{</span><span class="w">
  </span><span class="nt">"status"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"success"</span><span class="p">:</span><span class="w"> </span><span class="s2">"true"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"code"</span><span class="p">:</span><span class="w"> </span><span class="s2">"200"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"message"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Operation Successful"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre><pre class="highlight xml"><code># Item Level Response Code

<span class="nt">&lt;item_status&gt;</span>
<span class="nt">&lt;success&gt;</span>false<span class="nt">&lt;/success&gt;</span>
<span class="nt">&lt;code&gt;</span>1001<span class="nt">&lt;/code&gt;</span>
<span class="nt">&lt;message&gt;</span>Invalid Mobile Number<span class="nt">&lt;/message&gt;</span>
<span class="nt">&lt;/item_status&gt;</span>
</code></pre><pre class="highlight json"><code><span class="err">#</span><span class="w"> </span><span class="err">Item</span><span class="w"> </span><span class="err">Level</span><span class="w"> </span><span class="err">Response</span><span class="w"> </span><span class="err">Code</span><span class="w">
</span><span class="p">{</span><span class="w">
  </span><span class="nt">"item_status"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"success"</span><span class="p">:</span><span class="w"> </span><span class="s2">"false"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"code"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1001"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"message"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Invalid Mobile Number"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">

</span></code></pre>
<p>API responses are generated at request level and item level.</p>

<ul>
<li><strong>Request Level Responses</strong>: These response codes are generated at the request level (for an entire request).</li>
<li><strong>Item Level Responses</strong>: These response codes are generated at individual items of a request.</li>
</ul>

<aside class="notice"> For instance, assume that a batch API call is made to add multiple transactions. The entire request will have a status (successful, failed or partial success)and also each transaction item will have its own response code element. You can see API level response in the <status> element and item level in the <item_status> element.
</aside>

<h3 id="api-level-response-codes">API Level Response Codes</h3>

<table><thead>
<tr>
<th>Code</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>200</td>
<td>Success</td>
</tr>
<tr>
<td>201</td>
<td>Some requests have failed due to errors</td>
</tr>
<tr>
<td>500</td>
<td>All requests have failed due to errors</td>
</tr>
<tr>
<td>400</td>
<td>Input is invalid, Please check request parameters or input xml/json</td>
</tr>
<tr>
<td>401</td>
<td>Please check your username/password or authentication token</td>
</tr>
<tr>
<td>402</td>
<td>Version is not supported for this resource</td>
</tr>
<tr>
<td>404</td>
<td>Incorrect resource</td>
</tr>
<tr>
<td>405</td>
<td>Incorrect HTTP Method</td>
</tr>
<tr>
<td>406</td>
<td>Operation is not supported for the resource</td>
</tr>
<tr>
<td>407</td>
<td>Unknown Error happened while processing the request</td>
</tr>
<tr>
<td>408</td>
<td>Network MAC ID does not match</td>
</tr>
</tbody></table>

<h3 id="item-level-response-codes">Item Level Response Codes</h3>

<p>Each entity has a different set of response codes. Item level response codes for each entity is provided in the respective entity section. </p>

      </div>
      <div class="dark-box">
      </div>
    </div>
  </body>
</html>
